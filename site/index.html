<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TrueCloud | AWS EKS Portfolio</title>
    <meta name="description" content="Personal portfolio: VPC + EKS + ECR + GitHub OIDC + ALB + ACM + Route53, provisioned with Terraform." />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="header">
      <div class="container header__inner">
        <div class="brand">
          <div class="brand__mark">TC</div>
          <div class="brand__text">
            <div class="brand__name">TrueCloud</div>
            <div class="brand__tag">AWS • Terraform • Kubernetes</div>
          </div>
        </div>
        <nav class="nav">
          <a href="#overview">Overview</a>
          <a href="#architecture">Architecture</a>
          <a href="#components">Components</a>
          <a href="#pipeline">CI/CD</a>
          <a href="#cost">Cost</a>
          <a href="#security">SECURITY</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="hero" id="overview">
        <div class="container hero__inner">
          <div class="hero__text">
            <h1>End-to-end AWS EKS infrastructure, built with Terraform</h1>
            <p class="lead">
              This page is served by <strong>nginx</strong> running on <strong>EKS</strong> (2 pods) behind an
              <strong>internet-facing ALB</strong> with <strong>HTTP → HTTPS redirect</strong> and an ACM certificate.
            </p>
            <div class="pill-row">
              <span class="pill">Region: us-east-1</span>
              <span class="pill">Kubernetes: 1.33</span>
              <span class="pill">Nodes: 2 (t3.small • SPOT)</span>
              <span class="pill">Pods: 2</span>
              <span class="pill">Host: www.truecloud.com.br</span>
            </div>
            <div class="cta-row">
              <a class="btn btn--primary" href="#architecture">View architecture</a>
              <a class="btn btn--ghost" href="#pipeline">See deploy flow</a>
            </div>
          </div>

          <div class="hero__card">
            <div class="card-title">What’s provisioned</div>
            <ul class="checklist">
              <li>VPC with 6 subnets (2 public, 2 private, 2 db)</li>
              <li>IGW + public routing, 1 NAT Gateway for private egress</li>
              <li>EKS 1.33 + managed node group (2× t3.small, SPOT)</li>
              <li>ECR repo for app images + lifecycle policy</li>
              <li>GitHub Actions OIDC role for ECR push</li>
              <li>AWS Load Balancer Controller installed by Terraform (Helm + IRSA)</li>
              <li>ALB Ingress with TLS (ACM) + redirect</li>
            </ul>
            <div class="muted small">
              Sensitive values are masked (account IDs, ARNs, resource IDs).
            </div>
          </div>
        </div>
      </section>

      <section class="section" id="architecture">
        <div class="container">
          <h2>Architecture</h2>
          <p class="muted">
            The diagram below describes the complete solution: network, EKS, container registry, CI/CD and the web entrypoint.
          </p>

          <div class="panel">
            <div class="panel-header">
              <div>
                <div class="panel-title">Solution diagram</div>
                <div class="panel-subtitle">Rendered with Mermaid in the browser</div>
              </div>
              <button class="btn btn--small btn--ghost" id="copyDiagram">Copy diagram</button>
            </div>

            <div class="mermaid-wrap">
              <div class="mermaid" id="diagram">
flowchart LR
  User((User)) -->|"HTTPS 443"| ALB["ALB (Ingress)"]
  User -->|"HTTP 80"| ALB
  ALB -->|"HTTP -> HTTPS redirect"| ALB
  ALB --> Svc["K8s Service (ClusterIP)"]
  Svc --> Pod1["nginx pod #1"]
  Svc --> Pod2["nginx pod #2"]

  subgraph ciCd["CI/CD"]
    GHA["GitHub Actions (OIDC)"] -->|"AssumeRoleWithWebIdentity"| IAMRole["IAM Role (masked)"]
    IAMRole -->|"push"| ECR["ECR Repo projeto-eks/app"]
  end

  ECR -->|"pull"| Nodes["EKS Nodes (2× t3.small)"]
  Nodes --> Pod1
  Nodes --> Pod2

  subgraph awsNetwork["AWS Network (VPC 10.0.0.0/16)"]
    IGW["Internet Gateway"] --> PublicRT["Public route table"]
    PublicRT --> PublicA["Public subnet (AZ-a)"]
    PublicRT --> PublicB["Public subnet (AZ-b)"]
    PublicA --> NAT["NAT Gateway (single)"]
    PrivateRT["Private route table"] --> PrivateA["Private subnet (AZ-a)"]
    PrivateRT --> PrivateB["Private subnet (AZ-b)"]
    PrivateA --> NAT
    PrivateB --> NAT
    DB["DB subnets (no internet route)"]:::db
  end

  ALB --> PublicA
  ALB --> PublicB
  Pod1 --> PrivateA
  Pod2 --> PrivateB

  ACM["ACM Cert (*.truecloud.com.br)"] -->|"TLS"| ALB
  R53["Route53 record www.truecloud.com.br"] --> ALB

  classDef db stroke-dasharray: 5 5;
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="section" id="components">
        <div class="container">
          <h2>Components</h2>
          <div class="grid">
            <div class="tile">
              <div class="tile-title">Terraform (IaC)</div>
              <div class="tile-body">
                Modular Terraform structure provisioning VPC, EKS, ECR and GitHub OIDC integration.
              </div>
            </div>
            <div class="tile">
              <div class="tile-title">VPC</div>
              <div class="tile-body">
                2 public subnets, 2 private subnets, 2 isolated db subnets across 2 AZs, with a single NAT Gateway (cost-optimized).
              </div>
            </div>
            <div class="tile">
              <div class="tile-title">EKS</div>
              <div class="tile-body">
                Kubernetes 1.33, managed node group (2 nodes, t3.small • SPOT), workloads scheduled on private subnets.
              </div>
            </div>
            <div class="tile">
              <div class="tile-title">Ingress (ALB)</div>
              <div class="tile-body">
                AWS Load Balancer Controller (installed by Terraform via Helm + IRSA) creates an ALB with listeners 80/443, redirect and ACM TLS termination.
              </div>
            </div>
          </div>

          <div class="callout">
            <div class="callout-title">Masked identifiers</div>
            <div class="callout-body">
              Account: <code>5755••••2213</code> • ACM ARN: <code>arn:aws:acm:us-east-1:5755••••2213:certificate/66c2…a28d</code>
            </div>
          </div>
        </div>
      </section>

      <section class="section" id="pipeline">
        <div class="container">
          <h2>CI/CD (GitHub Actions → ECR → EKS)</h2>
          <ol class="steps">
            <li>Developer pushes to <code>main</code></li>
            <li>GitHub Actions uses OIDC to assume an IAM role (no long-lived AWS keys)</li>
            <li>Pipeline builds the container image and pushes to ECR</li>
            <li>EKS nodes pull the image from ECR and run the updated pods</li>
          </ol>
          <p class="muted">
            Provisioning workflow: run <code>terraform apply</code> once (infra + controller), then run
            <code>kubectl apply -f k8s/apps/portfolio-nginx/</code> once (app + ingress).
          </p>
          <p class="muted">
            Repository: <a href="https://github.com/rgtrovao/portfolio" target="_blank" rel="noreferrer">rgtrovao/portfolio</a>
          </p>
        </div>
      </section>

      <section class="section" id="cost">
        <div class="container">
          <h2>Cost notes</h2>
          <div class="grid">
            <div class="tile">
              <div class="tile-title">Single NAT Gateway</div>
              <div class="tile-body">
                NAT Gateway is one of the most expensive building blocks in small labs. This project uses a single NAT to reduce cost.
              </div>
            </div>
            <div class="tile">
              <div class="tile-title">EKS control plane</div>
              <div class="tile-body">
                EKS has a fixed hourly cost for the control plane. This is acceptable for a portfolio, but not “free”.
              </div>
            </div>
            <div class="tile">
              <div class="tile-title">Lifecycle policy in ECR</div>
              <div class="tile-body">
                Automatically expiring older images helps prevent ECR storage growth over time.
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="section" id="security">
        <div class="container">
          <h2>Security notes</h2>
          <ul class="bullets">
            <li>OIDC trust policy restricted to <code>rgtrovao/portfolio</code> and <code>refs/heads/main</code></li>
            <li>HTTPS enabled with ACM certificate and HTTP→HTTPS redirect</li>
            <li>DB subnets are isolated (no default route to internet)</li>
            <li>Workloads run in private subnets</li>
          </ul>
          <p class="muted">
            Tip: restrict the EKS public endpoint CIDRs after bootstrap to reduce exposure.
          </p>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="container footer__inner">
        <div class="small muted">© TrueCloud • Portfolio running on EKS</div>
        <div class="small muted">Built with Terraform + Kubernetes</div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="app.js"></script>
  </body>
</html>

